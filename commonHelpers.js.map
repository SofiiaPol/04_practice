{"version":3,"file":"commonHelpers.js","sources":["../src/lotr-api.js","../src/index2.js"],"sourcesContent":["import axios from 'axios';\n\n\nconst BASE_URL = 'https://the-one-api.dev/v2';\nconst BEARER_TOKEN = 'CF9pReNG_Lb_8KBokb0w';\n// const BEARER_TOKEN = 'XJlq9OFMcHAy8pAQK7xj';\n\nconst endpoints = {\n    character: 'character',\n}\n\nconst config = {\n    headers: { Authorization: `Bearer ${BEARER_TOKEN}` }\n}\n\nfunction getSearchUrl(endpoint, params) {\n    return `${BASE_URL}/${endpoint}?${params}`;\n}\n\nfunction getParams(page, sort) {\n    const template = {\n        page,\n        sort,\n        limit: 20,\n    }\n    return new URLSearchParams(template);    \n}\n\nasync function fetchUrl(endpoint, params) {\n    const url = getSearchUrl(endpoint, params);\n    console.log(url);\n    const data = await axios.get(url, config);\n    return data;\n}\n\n\nexport function getCharacters(page = 1, sorting = '') {    \n    const params = getParams(page, sorting);    \n    return fetchUrl(endpoints.character, params);\n}","import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\nimport { getCharacters } from './lotr-api';\n\n\nconst elements = {\n    searchForm: document.querySelector('.search-form'),\n    sortingButton: document.querySelector('button[type=\"submit\"]'),\n    gallery: document.querySelector('.gallery'),\n    guard: document.querySelector('.js-guard')\n}\n\nconst PER_PAGE = 20;\n\nlet total = 0;\nlet page = 1;\nlet sorting = '';\n\nconst guardOptions = {\n    root: null,\n    rootMargin: \"300px\",\n    treshhold: 1.0\n}\n\nconst scrollObserver = new IntersectionObserver(handlerLoadMore, guardOptions);\n\nfunction handlerLoadMore(entries) {\n    entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n            page += 1;\n            const searchResult = getCharacters(page, sorting);\n    \n            searchResult\n                .then(result => {                    \n                    renderResult(result.data);\n\n                    if (PER_PAGE * page >= total) {\n                        scrollObserver.unobserve(elements.guard);\n                    }\n                })\n                .catch(err => showErrorMessage(err.message));\n        }\n    });\n}\n\n\n\nfunction getListItemsHTML(docs) {\n    return docs.map(({ name, race = 'Unknown race' }) => {\n        return `            \n                <div class=\"photo-card\">                    \n                    <div class=\"info\">\n                        <p class=\"info-item\">\n                            <b>Name</b>\n                            <span>${name}</span> \n                        </p>\n                        <p class=\"info-item\">\n                            <b>Race</b>\n                            <span>${race}</span>\n                        </p>                        \n                    </div>\n                </div>            \n        `\n    }).join('');\n}\n\nfunction renderResult(data) {\n    console.log(data.docs);\n    elements.gallery.insertAdjacentHTML('beforeend', getListItemsHTML(data.docs));\n    \n    const { height: cardHeight } = elements.gallery.firstElementChild.getBoundingClientRect();\n\n    window.scrollBy({\n        top: cardHeight * 2,\n        behavior: \"smooth\",\n    });\n}\n\nfunction showErrorMessage(errorMessage) {\n    iziToast.show({\n        message: errorMessage,\n        messageColor: 'white',\n        backgroundColor: 'tomato',\n        timeout: 2500,\n        position: 'topRight'\n    });\n}\n\nfunction resetData() {\n    elements.gallery.innerHTML = '';\n    total = 0;\n    page = 1;\n    sorting = '';\n}\n\nfunction onSortingButtonClick(evt) {\n    evt.preventDefault();\n    resetData();\n\n    const form = new FormData(elements.searchForm);\n    const input = form.get('sorting').trim().toLowerCase();\n    sorting = (input === 'asc' || input === 'desc') ? input : '';\n    console.log(sorting);\n    const searchResult = getCharacters(1, `name:${sorting}`);\n    \n    searchResult\n        .then(result => {\n            if (result.status >= 400) {\n                throw new Error(\"Error\");\n            }\n\n            console.log(result.data);\n            total = result.data.total;\n            renderResult(result.data);\n\n            if (PER_PAGE * page < total) {\n                scrollObserver.observe(elements.guard);\n            }\n        })\n        .catch(err => console.log(err));\n}\n\nelements.sortingButton.addEventListener('click', onSortingButtonClick);\n"],"names":["BASE_URL","BEARER_TOKEN","endpoints","config","getSearchUrl","endpoint","params","getParams","page","sort","template","fetchUrl","url","axios","getCharacters","sorting","elements","PER_PAGE","total","guardOptions","scrollObserver","handlerLoadMore","entries","entry","result","renderResult","err","showErrorMessage","getListItemsHTML","docs","name","race","data","cardHeight","errorMessage","iziToast","resetData","onSortingButtonClick","evt","input"],"mappings":"6vBAGA,MAAMA,EAAW,6BACXC,EAAe,uBAGfC,EAAY,CACd,UAAW,WACf,EAEMC,EAAS,CACX,QAAS,CAAE,cAAe,UAAUF,GAAgB,CACxD,EAEA,SAASG,EAAaC,EAAUC,EAAQ,CACpC,MAAO,GAAGN,KAAYK,KAAYC,GACtC,CAEA,SAASC,EAAUC,EAAMC,EAAM,CAC3B,MAAMC,EAAW,CACb,KAAAF,EACA,KAAAC,EACA,MAAO,EACV,EACD,OAAO,IAAI,gBAAgBC,CAAQ,CACvC,CAEA,eAAeC,EAASN,EAAUC,EAAQ,CACtC,MAAMM,EAAMR,EAAaC,EAAUC,CAAM,EACzC,eAAQ,IAAIM,CAAG,EACF,MAAMC,EAAM,IAAID,EAAKT,CAAM,CAE5C,CAGO,SAASW,EAAcN,EAAO,EAAGO,EAAU,GAAI,CAClD,MAAMT,EAASC,EAAUC,EAAMO,CAAO,EACtC,OAAOJ,EAAST,EAAU,UAAWI,CAAM,CAC/C,CCjCA,MAAMU,EAAW,CACb,WAAY,SAAS,cAAc,cAAc,EACjD,cAAe,SAAS,cAAc,uBAAuB,EAC7D,QAAS,SAAS,cAAc,UAAU,EAC1C,MAAO,SAAS,cAAc,WAAW,CAC7C,EAEMC,EAAW,GAEjB,IAAIC,EAAQ,EACRV,EAAO,EACPO,EAAU,GAEd,MAAMI,EAAe,CACjB,KAAM,KACN,WAAY,QACZ,UAAW,CACf,EAEMC,EAAiB,IAAI,qBAAqBC,EAAiBF,CAAY,EAE7E,SAASE,EAAgBC,EAAS,CAC9BA,EAAQ,QAASC,GAAU,CACnBA,EAAM,iBACNf,GAAQ,EACaM,EAAcN,EAAMO,CAAO,EAG3C,KAAKS,GAAU,CACZC,EAAaD,EAAO,IAAI,EAEpBP,EAAWT,GAAQU,GACnBE,EAAe,UAAUJ,EAAS,KAAK,CAE/D,CAAiB,EACA,MAAMU,GAAOC,EAAiBD,EAAI,OAAO,CAAC,EAE3D,CAAK,CACL,CAIA,SAASE,EAAiBC,EAAM,CAC5B,OAAOA,EAAK,IAAI,CAAC,CAAE,KAAAC,EAAM,KAAAC,EAAO,kBACrB;AAAA;AAAA;AAAA;AAAA;AAAA,oCAKqBD;AAAA;AAAA;AAAA;AAAA,oCAIAC;AAAA;AAAA;AAAA;AAAA,SAK/B,EAAE,KAAK,EAAE,CACd,CAEA,SAASN,EAAaO,EAAM,CACxB,QAAQ,IAAIA,EAAK,IAAI,EACrBhB,EAAS,QAAQ,mBAAmB,YAAaY,EAAiBI,EAAK,IAAI,CAAC,EAE5E,KAAM,CAAE,OAAQC,CAAY,EAAGjB,EAAS,QAAQ,kBAAkB,wBAElE,OAAO,SAAS,CACZ,IAAKiB,EAAa,EAClB,SAAU,QAClB,CAAK,CACL,CAEA,SAASN,EAAiBO,EAAc,CACpCC,EAAS,KAAK,CACV,QAASD,EACT,aAAc,QACd,gBAAiB,SACjB,QAAS,KACT,SAAU,UAClB,CAAK,CACL,CAEA,SAASE,GAAY,CACjBpB,EAAS,QAAQ,UAAY,GAC7BE,EAAQ,EACRV,EAAO,EACPO,EAAU,EACd,CAEA,SAASsB,EAAqBC,EAAK,CAC/BA,EAAI,eAAc,EAClBF,IAGA,MAAMG,EADO,IAAI,SAASvB,EAAS,UAAU,EAC1B,IAAI,SAAS,EAAE,KAAI,EAAG,cACzCD,EAAWwB,IAAU,OAASA,IAAU,OAAUA,EAAQ,GAC1D,QAAQ,IAAIxB,CAAO,EACED,EAAc,EAAG,QAAQC,GAAS,EAGlD,KAAKS,GAAU,CACZ,GAAIA,EAAO,QAAU,IACjB,MAAM,IAAI,MAAM,OAAO,EAG3B,QAAQ,IAAIA,EAAO,IAAI,EACvBN,EAAQM,EAAO,KAAK,MACpBC,EAAaD,EAAO,IAAI,EAEpBP,EAAWT,EAAOU,GAClBE,EAAe,QAAQJ,EAAS,KAAK,CAErD,CAAS,EACA,MAAMU,GAAO,QAAQ,IAAIA,CAAG,CAAC,CACtC,CAEAV,EAAS,cAAc,iBAAiB,QAASqB,CAAoB"}